# NDC 2012 Note

## 온라인 게임과 소셜 게임 서버는 어떻게 다를까?
### 사례로 살펴보는 비교 분석

##### Speaker: 윤석주 (넥슨 신사업본부 마젤란팀)

* 온라인 게임은?
	* MMORPG
		* 유저 데이터가 많고 트랜젝션의 원자성이 보장되어야 함. 안되면 아이템 복사 ㅎㄷㄷ
		* 상호작용, 공간공유 - 브로드 캐스트 부하가 큼.
			* 그래서 서버 분리.
			* 아키에이지의 예
	* 캐주얼 게임?
		* 유저 데이터가 적은 편.
* 소셜 게임 - 2012 서울과 팜빌 비교
	* 팜빌의 수확 = 2012 서울의 미사일 생산
	* 2012 서울의 퀘스트 시스템
	* MMORPG보다 유저 데이터가 적은 편
	* 클라이언트 -> 프론트(채널 서버) -> 프로세스(사용자 액션, 소셜 기능) -> 게임 디비
	프론트 -> 인증 서버, 프론트->로그 디비
	* 런칭 이후
		* 유저 액션이 병렬적, 처리량이 많다.
		* 하지만 프로세스는 확장 불가.
		* 도시 방문 기능은 로그인과 비슷, 타워 UFO 정보 나눠둔 것에 엄청난 추가 부하
	* 구조 개선
		* 꼭 연결을 유지할 필요가 있나? -> HTTP 프로토콜, PHP 기반
		* 구조 단순화로 관리비용 절감 - 프론트-프로세스 통합, 디비 동기화
		* 디비 업데이트가 몰릴 것을 예상 - NoSQL로 이동. 읽기는 SQL이 빠르지만, 업데이트는 부하가 몰릴수록 NoSQL이 빠름.
	* membase
		* NoSQL 서버?
		* 편리한 관리툴
		* 추가작업
			* 데이터 검색 어려움 - 게임 로그를 상세하게
			* 키 기반 스토리지 - 유저 데이터를 통째로 serialize 해서 저장
			* 트랜젝션의 부재 - 게임 서버에서 모든 액션이 성공하면 Write
			* 잠금의 부재 - Atomic 명령인 ADD를 통해 구현
	* 생각보다 성능이 안 나온다.
		* 유저 데이터 로드, (de)serialize 비용이 비쌈.
			- php 내장 캐시인 APC를 사용하여 객체 캐시.
		* memcache로 최신인지 체크
		* 서버가 여러대라 캐시 히트가 낮음
			- 소프트웨어적으로 최대한 같은 서버로 접속하게.
	* 이전 서버와 비교하면
		- 구조 개선으로 성능 향상
		- 유저 데이터를 통으로 보관: 소셜 기능에 부담 덜어냄
		- 이제 게임 서버가 병목이면 게임 서버 추가, 디비 병목이면 디비 서버 추가:관리 편의 증가
	* 다른 회사와 비교하면
		- Wooga: 웹 서버 왕창 넣고, 디비 왕창 넣고, 업데이트가 적은 데이터는 디비에, 잦은 곳은 NoSQL에.
		- Zynga: 디비 서버에 캐시를 씌우고, 웹서버가 모두 핸들링.

### 정리
* 디비 부하
	* NoSQL 도입
* 브로드캐스트 부하
	* 없다! 대신 소셜 요소 고려.
* 보너스
	* 접속을 웹으로 바꿨더니
		- 플래시게임이라 php와 플래시 파일 교체를 하면 패치 완료.
		- 점검시간 0
	* 웹은 단방향인데?
		- 양방향 통신도 가능.
		- 내일 세션에서…
	* 언어적인 부분
		- php 쓰지 마세요 ㅠㅠ

### Q&A
* 로그 디비를 몽고디비 쓰셨다고 하는데, 성능이 어떤지? 그리고 디비의 차등 기능을 안 쓰신 듯? - 서버 하나에 로그만 밀어넣는 식이라 성능은 고려 안 함. 차등 기능은 굳이 사용할 필요가 없어서 사용하지 않음.
* 제온 쿼드로 서버 동접 몇? 로드 밸런싱 차이? - 웹 서버이고 분 단위로 활동하기에 정확히 알 수 없음.
* 하드웨어 사양이 어떻길래 그 정도 리퀘만(?) 처리? - ASP.net 도입 안 한 이유? - 첨엔 좀 안일하게 해서, 유저 데이터를 계속 로드하고 있어서… ASP.NET 도입 안 한 이유는 비용 절감이 큰 이유.
* 소개한 디비의 장점? - 캐시가 좋아서, Scale-out 편의, 관리 편의성. 그리고 Zynga가 사용하기 때문에.
* 유저 데이터를 통으로 Serialize한다고 했는데, 만약 데이터가 잘못되면? - 로그 남겨두고 있음. 이벤트를 해야한다면, 로그를 뒤져서 수작업으로 지급하려 했으나 실행하진 않음.
* php 비추한다면 어떤 언어를? - 딱히 다른 걸 선택 할 수 없…
* 