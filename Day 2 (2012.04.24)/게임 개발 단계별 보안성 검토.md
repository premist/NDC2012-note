# NDC 2012 Note

## 게임 개발 단계별 보안성 검토 항목과 방법

##### Speaker: 박인신 (네오플)

### 왜 필요한가?
* 현실
	* 상용화 하자마자 작업장 포화
	* 중국 진출하자마자 프리서버
	* 여름방학 (미출시) 캐릭터 이미지 유출
	* 신규 던전, 작업장이 입구 막음
	* 등등등 이슈 다수. 모두 현실
* 사후약방문보다 미리미리 하는 게 훨씬 낫다!

### 디자인 단계
* 개발단계별 보안 니즈 체크
	* 단계별 게임 보안 위협 분석
* 핵, 작업장 유입 경로 차단
	* 데미지 방식 검토
		* 처음에 못하면 나중엔, 검증 주체
	* 트레이드 방식 검토
		* 거래 확인창, 로그, 로직, 시퀀스
	* 아이템 드롭/귀속 방식 검토
		* 랜덤한 드롭, 겟, 추적이 되도록 설계한다면…
	* 오브젝트 로딩 방식 검토 - 인지하기 어렵도록 배치한다면…
	* 메시지 입력방식 - 한정된 방법만 검토?

### 프로토타입 단계
* 데이터 유출과 소스 관리
	* 개발 존을 분리와 하드 암호화 - 인력 이동이 잦은 경우.
	* 작업이력관리 / 리소스 백업 - 소스 관리가 안 되면 그게 보안 구멍
	* 니니지3 소스 유출 건 - 개발 존 분리가 안되어서
* 로직 점검과 보안 라이브러리 구축
	* 기본 로직 검증, 패킷 시퀀스/넘버링
		* 특히, 거래 과정의 복제나 재사용, 진입점 차단
	* 암호화를 통한 진입 장벽 쌓기
		* 패킷과 메모리를 암호화 혹은 난독화(Obfuscation)
	* 데이터 무결성 확보
		* 보안 변수 개발과 무결성 체크는 이중의 체크 장치가 될 것.

### 알파테스트 단계
* 배포에 대한 기본적인 보안
	* 운영 존, 테스트 존 분리 - 퀄리티와 콘텐츠에 대한 충분한 검토
	* 문자열 정보 관리 - 코드 내 문자열 정보는 조은 먹잇감
	* 리소스와 실행파일 보호 - 패킹은 콘텐츠 보호의 첨병
* 각종 시스템 설계, 취약점 점검 및 제거
	* 로그 / 통계 시스템 설계
		* 디버깅 로그 및 각종 검증 로그와 통계 시스템 설계 고려
		* 핵, 작업장 관련 통계는 예측, 관제 가능
	* 게임 소스 취약점 점검
	* 디버깅 정보/시스템 정보 삭제 실행 - 서버 IP, MAC 주소 등
### CBT 단계
* 본격적 배포, 진입 장벽 두기
	* 암호화 라이브러리 적용 - 다수의 cipher를 적용하고 일정기간 내 키를 교체할 수 있도록
	* 문자열 삭제 - 패커는 메모리 상에서 의미가 없음
		* 클라이언트 바이너리 내부 문자열은 해커들의 분석 포인트
			i. 문자열 상수
			i. 미리 정의된 매크로
			i. 외부 라이브러리에 포함된 문자열
			i. 디버깅 심볼
* 돌다리도 두들겨 보자
	* 기본 콘텐츠 정보를 테이블화
		* 처음에 해두면 천국, 나중에 하면 노가다
	* 사전 게임 보안 분석 보고서
		* 오베나 상용화 때 어떤 핵, 매크로가 나올지 예측 가능
	* 패킷/함수/번수명 난독화 - 누가 봐도 알기 쉬운 명칭을 변경 CS_SEND_MESSAGE …

### OBT 단계
* 게임 주변 환경 체크
	* 프리서버
		1. 미들웨어의 복잡성을 증가시키기
			- 통신이 많을수록 유리
		2. 바이너리 유출 방지(OpenSSL 보단 자체 솔루션이 필요)
			- 지속적인 유출 방지
	* 게임 보안 솔루션 적용
		- 능동적으로 대체 가능한 솔루션 선택 필요
	* 각종 운영 툴(로그/통계/CS)
		- 오베 때 발생하는 문제를 적절하게 해결하지 못하는 이유는 대부분 문제 확인이 어렵기 때문이다.
		- 디버깅 정보 및 검증 로그를 별도의 툴로 이관 (크래시 덤프도 난독화해야)
	* 보안운영/관제계획 수립 - 리스크 관리 차원에서 게임 보안 조직이 필요.
	* 오픈과 함께 프로토콜을 바꿔라
		i. 개별적으로 여러 암호화 알고리즘을 사용.
		i. 주기적으로 키 변경
		i. C/S간 약속된 암호화 키를 사용하지 말 것.
	* 게임/개인 정보 보호
		- 덤프 파일도 난독화
		- 디비 양방향 암호와 저장된 데이터의 단방향 암호화
	* 웹도 챙겨야
		- SSL 적용
		- 이미지 업로드 서버 분리 - 이미지 서버에는 백신을
		- 능동적 키보드 보안 - 터널링 되는.
		- 웹 방화벽
		- 비밀번호 정책 수립 - 비번은 식별자일 뿐, 암호화 수단이 아님.
* 관제와 모니터링
	* 웹 개발존 내지 테스트 존 분리
		- 같은 회원 디비를 쓰니까 Mirror DB로 분리해줘야.
	* 로드 밸런싱, 방화벽 구분/네트워크 관제 + 핵 모니터링
		- DDoS, Bruteforce attack 관제 시작해야 함 - 요즘은 디도스 공격을 눈치채지 못하게 조금씩 보내어 오버플로우 유도.
	* 시스템/네트워크 보안 규정 및 감사 계획 수립
		- 침해는 이 때부터 시작됨
	* 게임 보안 패치 계획 수립

### 상용화 단계
* 계획의 실행
	* 개인정보 보호정책, BAN 정책 발표
		- 보안 관제를 위해 클라이언트 정보 일부를 획득해야 함.
		- 필요에 따라 변경되는 밴 정책은 누더기가 될 확률이 높음.
	* 시스템/네트워크 보안 규정, 감사 계획 실행
		- 웹에 대한 침입 테스트(PT)를 이 때 수행하면 좋다.
	* 웹상에서 입력되는 입력값 검증(HTML 태그 등), 백신 적용 및 배포
	* 작업장 재화 감시 모니터링
* 혼돈을 주자
	* 게임 프로토콜 혹은 암호화 방식 변경
		- 클라별로 키를 달리 가져가면 매크로 배포 차단에 효과 있음
		- 초기에 준비해둬야지, 나중엔 하기 어려움
	* GM 명령어 변경 - 테스트 때 사용되던 명령어는 이미 분석됨
* 계정을 보호
	* 2차 계정 보안 솔루션 - 게임 특성에 맞게 설계
		- 저사양 게임은 웹브라우저 보완
		- 성인용 게임은 휴대폰 기반
		- 등등

### QNA
* 모든 함수를 난독화 해야하나? - 꼭 그럴 필요는 없고, 중요한 것만 해도 됨. 그리고 이러한 내용은 적어도 개발자끼리는 공유되어야.