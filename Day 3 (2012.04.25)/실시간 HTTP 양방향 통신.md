# NDC 2012 Note

## 실시간 HTTP 양방향 통신

##### Speaker: 이승재 (넥슨 M2팀, @_rica)

### HTTP
* 웹브라우저와 웹서버가 통신하는 규약
* 요청/응답 형태
* 서버에서 요청하면 브라우저에서 받을 수 없다.
* 그런데 트위터, 구글 토크는 받는다. 어떻게?

### 양방향 통신
#### 주요 기법/기술
* 주의: 다 꼼수들임
* 폴링(polling)
	* 브라우저가 주기적으로 요청을 보냄
	* 받을 게 없어도 서버에 부하가 걸림. 트래픽 많음.
	* 지연 시간 길다.
* 롱 폴링(long polling)
	* 요청을 보내되, 보내줄 게 없으면 끊지 않고 생길 때 까지 기다림.
	* 페북에서 사용.
	* 요청을 보내지 않았는데 서버에서 보낼 게 있으면 쌓아놨다가 요청을 보내면 즉시 응답, 즉시 다음 요청, 대기.
	* 구현이 복잡하고, 지연 시간 있음.
* 숨겨놓은 iframe
	* 페이지를 열어 대기 상태로 두고, 필요한 데이터를 조금씩 보냄.
	* 브라우저 메모리 누수가 생김.
	* 프록시, 보안 프로그램과 충돌
* 브라우저 플러그인
	* 플래시, ActiveX
	* 소켓 부분만 만들어서 자바스크립트와 상호작용.
	* 호환성 문제
* 웹소켓
	* 자바스크립트에서 진짜 소켓을 쓰듯이!
	* 보안 문제로 제약이 있음.
	* 아직 표준화 안 됨.
	* 호환성.
* 그래서 롱 폴링을 구현하기로 함.
#### AJAX 롱 폴링 경험담
* IRC 웹 브릿지 제작
	* 스마트폰에서 IRC 하고 싶어서.
	* IRC 앱을 켜놓지 않아도 접속 유지 - 켜면 지난 로그를 읽을 수 있고.
	* 취미 프로젝트, 프로그래머 둘(안드로이드, 아이폰)이서 2011년 3월 시작.
	* 설계상 난점 - 응답에서 다음 요청까지 시간이 빈다. 이 때 사건이 발생하는 경우를 빠뜨리면 안 됨. 자연스럽게 Stateless하게 만들어짐.
	* 구현상 난점 - 멀티스레드: HTTP처리/이벤트 리스닝 스레드
		- node.js 같은 모델을 썼으면 쉽게 만들었을 듯.
	* 보내기도 걱정
		- 네트워크 불안정
		- 재전송, 중복방지 메커니즘 필요
		- 이쯤되면 HTTP로 TCP 구현하는 꼴.
#### 그 외
* 자동으로 해주면 안되나?
	* 할 수 있지만, 미들웨어가 편함.
	* Orbited
		- orbited2.js + Server
		- 소켓을 흉내낸다.
	* Socket.io
		- Node.js 모듈
		- 메시지 단위 전송을 제공
	* 실제로 쓰려면…
		- 커넥션 하나에 서버자원 얼마?
		- 커넥션이 불안정하면?
		- 웹브라우저 한동안 닫아뒀다 다시 열면?

#### 요약
* 주요 기법
* 제작 경험
* 미들 웨어
* 게임에서 응용?
	* 웹 게임 - 네트워크 제약이 (거의) 없어진다.
	* 게임-웹 연동
		- 와우 전투정보실, 거래소(아이온, 마영전), 업적(넥슨홈, 스팀)
		- 웹에서 실시간 통신이 가능하면 뭘 더 할 수 있을까?
* 취미 프로젝트 좋아요
	* 재미있다
	* 업무로 다루지 않는 기술을 써볼 수 있다.
	* 공부가 된다.
	* ~~NDC 발표할 수 있다~~
